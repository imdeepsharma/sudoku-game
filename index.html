<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HTML5 Sudoku Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f7f7f7;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 0;
        }
        h1 {
            margin-top: 30px;
        }
        #difficulty {
            margin: 20px 0;
        }
        #sudoku-board {
            display: grid;
            grid-template-columns: repeat(9, 40px);
            grid-template-rows: repeat(9, 40px);
            gap: 2px;
            background: #222;
            border: 4px solid #222;
        }
        .cell {
            width: 40px;
            height: 40px;
            background: #fff;
            text-align: center;
            font-size: 20px;
            outline: none;
            border: none;
            box-sizing: border-box;
            transition: background 0.2s;
        }
        .cell:focus {
            background: #e0f7fa;
        }
        .prefilled {
            font-weight: bold;
            background: #e0e0e0;
            color: #333;
        }
        .invalid {
            background: #ffcdd2 !important;
        }
        #controls {
            margin: 20px 0;
        }
        #message {
            margin-top: 10px;
            min-height: 20px;
            color: #2e7d32;
        }
        #timer {
            font-size: 18px;
            font-weight: bold;
            margin-top: 10px;
        }
        /* Bold borders for 3x3 */
        #sudoku-board .cell:nth-child(3n+1) { border-left: 3px solid #222; }
        #sudoku-board .cell:nth-child(n+19):nth-child(-n+27),
        #sudoku-board .cell:nth-child(n+46):nth-child(-n+54) { border-bottom: 3px solid #222; }
        .cell {
            border-top: 1px solid #aaa;
            border-left: 1px solid #aaa;
        }
        .cell:nth-child(n+1):nth-child(-n+9) { border-top: 3px solid #222; }
        .cell:nth-child(9n) { border-right: 3px solid #222; }
        .cell:nth-child(n+73):nth-child(-n+81) { border-bottom: 3px solid #222; }
    </style>
</head>
<body>
    <h1>Sudoku Game</h1>
    <div id="difficulty">
        <label>Difficulty: </label>
        <select id="difficulty-select">
            <option value="easy">Easy</option>
            <option value="difficult">Difficult</option>
            <option value="expert">Expert</option>
        </select>
        <button id="new-game">New Game</button>
    </div>
    <div id="controls">
        <button id="check">Check</button>
        <button id="solve">Solve</button>
    </div>
    <div id="timer">Timer: 00:00</div>
    <div id="sudoku-board"></div>
    <div id="message"></div>
    <script>
        // Example puzzles for each difficulty (0 means empty)
        const puzzles = {
            easy: [
                [0,0,0,2,6,0,7,0,1, 6,8,0,0,7,0,0,9,0, 1,9,0,0,0,4,5,0,0,
                 8,2,0,1,0,0,0,4,0, 0,0,4,6,0,2,9,0,0, 0,5,0,0,0,3,0,2,8,
                 0,0,9,3,0,0,0,7,4, 0,4,0,0,5,0,0,3,6, 7,0,3,0,1,8,0,0,0],
            ],
            difficult: [
                [0,2,0,6,0,8,0,0,0, 5,8,0,0,0,9,7,0,0, 0,0,0,0,4,0,0,0,0,
                 3,7,0,0,0,0,5,0,0, 6,0,0,0,0,0,0,0,4, 0,0,8,0,0,0,0,1,3,
                 0,0,0,0,2,0,0,0,0, 0,0,9,8,0,0,0,3,6, 0,0,0,3,0,6,0,9,0],
            ],
            expert: [
                [1,0,0,0,0,7,0,9,0, 0,3,0,0,2,0,0,0,8, 0,0,9,6,0,0,5,0,0,
                 0,0,5,3,0,0,9,0,0, 0,1,0,0,8,0,0,0,2, 6,0,0,0,0,4,0,0,0,
                 3,0,0,0,0,0,0,1,0, 0,4,1,0,0,0,0,0,7, 0,0,7,0,0,0,3,0,0],
            ]
        };

        let currentPuzzle = [];
        let solution = [];
        let timerInterval;
        let secondsElapsed = 0;

        const boardDiv = document.getElementById("sudoku-board");
        const messageDiv = document.getElementById("message");

        // Function to update the timer display
        function updateTimer() {
            secondsElapsed++;
            const minutes = Math.floor(secondsElapsed / 60);
            const seconds = secondsElapsed % 60;
            document.getElementById("timer").textContent = `Timer: ${pad(minutes)}:${pad(seconds)}`;
        }

        // Function to pad single digit numbers (e.g., "5" to "05")
        function pad(num) {
            return num < 10 ? `0${num}` : num;
        }

        // Function to start the timer
        function startTimer() {
            // Reset the timer
            secondsElapsed = 0;
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(updateTimer, 1000); // Update every second
        }

        function copyBoard(arr) {
            return arr.map(x => Array.isArray(x) ? copyBoard(x) : x);
        }

        function parsePuzzle(linear) {
            let board = [];
            for (let i = 0; i < 9; i++) {
                board.push(linear.slice(i * 9, (i + 1) * 9));
            }
            return board;
        }

        function linearize(board) {
            return board.flat();
        }

        function renderBoard(board, readonlyMap = null) {
            boardDiv.innerHTML = "";
            for (let r = 0; r < 9; r++) {
                for (let c = 0; c < 9; c++) {
                    const cell = document.createElement("input");
                    cell.type = "text";
                    cell.maxLength = 1;
                    cell.className = "cell";
                    cell.dataset.row = r;
                    cell.dataset.col = c;
                    if (board[r][c] !== 0) {
                        cell.value = board[r][c];
                        cell.readOnly = true;
                        cell.classList.add("prefilled");
                    } else {
                        cell.value = "";
                        cell.readOnly = false;
                        cell.addEventListener("input", onInputCell);
                        cell.addEventListener("keydown", onArrowKeys);
                    }
                    boardDiv.appendChild(cell);
                }
            }
        }

        function onInputCell(e) {
            const val = e.target.value;
            if (val && (!/^[1-9]$/.test(val))) {
                e.target.value = "";
                return;
            }
            // Remove invalid marker if any
            e.target.classList.remove("invalid");
            messageDiv.textContent = "";
            if (val) {
                if (!isValidMove(readBoard(), parseInt(e.target.dataset.row), parseInt(e.target.dataset.col), parseInt(val))) {
                    e.target.classList.add("invalid");
                    messageDiv.style.color = "#c62828";
                    messageDiv.textContent = "Invalid move!";
                }
            }
        }

        function onArrowKeys(e) {
            const row = parseInt(e.target.dataset.row);
            const col = parseInt(e.target.dataset.col);
            let next;
            if (["ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight"].includes(e.key)) {
                e.preventDefault();
                switch (e.key) {
                    case "ArrowUp":
                        next = boardDiv.querySelector(`.cell[data-row="${(row - 1 + 9) % 9}"][data-col="${col}"]`);
                        break;
                    case "ArrowDown":
                        next = boardDiv.querySelector(`.cell[data-row="${(row + 1) % 9}"][data-col="${col}"]`);
                        break;
                    case "ArrowLeft":
                        next = boardDiv.querySelector(`.cell[data-row="${row}"][data-col="${(col - 1 + 9) % 9}"]`);
                        break;
                    case "ArrowRight":
                        next = boardDiv.querySelector(`.cell[data-row="${row}"][data-col="${(col + 1) % 9}"]`);
                        break;
                }
                if (next && !next.readOnly) next.focus();
            }
        }

        function readBoard() {
            let board = [];
            const cells = boardDiv.querySelectorAll(".cell");
            for (let r = 0; r < 9; r++) {
                let row = [];
                for (let c = 0; c < 9; c++) {
                    const idx = r * 9 + c;
                    const val = cells[idx].value;
                    row.push(val ? parseInt(val) : 0);
                }
                board.push(row);
            }
            return board;
        }

        function isValidMove(board, row, col, num) {
            for (let i = 0; i < 9; i++) {
                if (i !== col && board[row][i] === num) return false;
                if (i !== row && board[i][col] === num) return false;
            }
            const br = Math.floor(row / 3) * 3, bc = Math.floor(col / 3) * 3;
            for (let dr = 0; dr < 3; dr++) {
                for (let dc = 0; dc < 3; dc++) {
                    const r = br + dr, c = bc + dc;
                    if ((r !== row || c !== col) && board[r][c] === num) return false;
                }
            }
            return true;
        }

        function findEmpty(board) {
            for (let r = 0; r < 9; r++)
                for (let c = 0; c < 9; c++)
                    if (board[r][c] === 0)
                        return [r, c];
            return null;
        }

        function solveSudoku(board) {
            const empty = findEmpty(board);
            if (!empty) return true;
            const [row, col] = empty;
            for (let num = 1; num <= 9; num++) {
                if (isValidMove(board, row, col, num)) {
                    board[row][col] = num;
                    if (solveSudoku(board)) return true;
                    board[row][col] = 0;
                }
            }
            return false;
        }

        function checkSolution() {
            const userBoard = readBoard();
            let complete = true, valid = true;
            for (let r = 0; r < 9; r++) {
                for (let c = 0; c < 9; c++) {
                    if (userBoard[r][c] === 0) complete = false;
                    if (userBoard[r][c] !== 0 && !isValidMove(userBoard, r, c, userBoard[r][c])) {
                        valid = false;
                        const idx = r * 9 + c;
                        boardDiv.children[idx].classList.add("invalid");
                    }
                }
            }
            if (valid && complete) {
                // Stop the timer when puzzle is solved
                clearInterval(timerInterval);
                messageDiv.style.color = "#2e7d32";
                messageDiv.textContent = "Congratulations! You solved the puzzle!";
            } else if (!valid) {
                messageDiv.style.color = "#c62828";
                messageDiv.textContent = "There are mistakes in the puzzle.";
            } else {
                messageDiv.style.color = "#f9a825";
                messageDiv.textContent = "Keep going!";
            }
        }

        function showSolution() {
            renderBoard(solution, true);
            messageDiv.style.color = "#1976d2";
            messageDiv.textContent = "Solution shown!";
        }

        function newGame() {
            messageDiv.textContent = "";
            const diff = document.getElementById("difficulty-select").value;
            // Pick a random puzzle from the given pool for variety
            const pool = puzzles[diff];
            const linearPuzzle = pool[Math.floor(Math.random() * pool.length)];
            currentPuzzle = parsePuzzle(linearPuzzle);
            // Find the solution for this puzzle
            const boardCopy = copyBoard(currentPuzzle);
            solveSudoku(boardCopy);
            solution = boardCopy;
            renderBoard(currentPuzzle);
            
            // Start the timer when a new game begins
            startTimer();
        }

        document.getElementById("new-game").onclick = newGame;
        document.getElementById("check").onclick = checkSolution;
        document.getElementById("solve").onclick = showSolution;

        // Start with a puzzle (also starts the timer)
        newGame();
    </script>
</body>
</html>
